#! /bin/sh -f
#\
mkdir -p logfiles
#\
mkdir -p patterns
#\
exec tessent -shell -log logfiles/$0.log -replace -dofile "$0"

set PDK_ROOT ../../../tech


set_context patterns -scan

# Specify where the tsdb_outdir is to be located, default is at the current working directory
set_tsdb_output_directory ../tsdb_outdir

read_cell_library ${PDK_ROOT}/tessent/ihp-sg13g2_stdcell.tcelllib
read_cell_library ${PDK_ROOT}/tessent/ihp-sg13g2_io.tcelllib
read_cell_library ${PDK_ROOT}/tessent/memories/RM_IHPSG13_1P_256x64_c2_bm_bist.atpglib

## Reads in the scan inserted netlist/design
read_design croc_soc_GpioCount32  -design_id gate3 -view graybox -verbose
set_current_design croc_soc_GpioCount32



# Specify the current mode using a different name than what was used during scan insertion with add_scan_mode command
set_current_mode ext_multi_transition -type external

report_dft_signals

# Extract the external mode specified during scan insertion to run ATPG
import_scan_mode ext_mode
report_core_instances
add_black_box -auto
set_system_mode analysis
report_clocks

# Set fault type to generate transition patterns
set_fault_type transition
set_pattern_type -sequential 2

# For normal transition patterns at chip level or for core level Internal mode patterns, it is necessary
# to ignore activity on both input and output pins. In this scenario though, the point is to emulate what
# transition faults might be detected at the boundary of this core when configure in External mode. So
# it is necessary to override the settings that are automatically set by the tool for transition patterns
# that prevents activity at the PIs and POs.  This is done with the following two commands:
set_transition_holdpi off
set_output_mask off

set_xclock_handling x

# Generate patterns
create_patterns

# Store TCD, flat_model, fault list and patDB format files in the TSDB directory
write_tsdb_data -replace

# Write Verilog patterns for simulation
write_patterns patterns/croc_soc_GpioCount32_ext_transition_parallel.v -verilog -parallel -replace -parameter_list {SIM_KEEP_PATH 1}
set_pattern_filtering -sample_per_type 2
write_patterns patterns/croc_soc_GpioCount32_ext_transition_serial.v -verilog -serial -replace -parameter_list {SIM_KEEP_PATH 1}


exit

